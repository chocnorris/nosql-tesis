CREATE DATABASE IF NOT EXISTS forum;
USE forum;

CREATE TABLE IF NOT EXISTS Authors (
	id INTEGER AUTO_INCREMENT NOT NULL,
	Name VARCHAR(45) NOT NULL,
	Photo LONGBLOB,

	PRIMARY KEY (id)
) ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS Base (
	id INTEGER AUTO_INCREMENT NOT NULL,
	author_id INTEGER NOT NULL,
	Date DATE NOT NULL,
	CommentCount INTEGER NOT NULL,
	
	PRIMARY KEY (id),
	FOREIGN KEY(author_id) REFERENCES Authors(id) ON DELETE CASCADE
) ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS Threads (
	id INTEGER NOT NULL,
	Title VARCHAR(45) NOT NULL,
	
	PRIMARY KEY (id),
	FOREIGN KEY(id) REFERENCES Base(id) ON DELETE CASCADE
) ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS Tags (
	thread_id INT NOT NULL,
	Tag VARCHAR(45) NOT NULL,
	FOREIGN KEY(thread_id) REFERENCES Base(id) ON DELETE CASCADE
) ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS Comments (
	id INTEGER NOT NULL,
	Text TEXT NOT NULL,
	thread_id INTEGER NOT NULL,
	parent_id INTEGER NOT NULL,
	
	PRIMARY KEY (id),
	FOREIGN KEY(id) REFERENCES Base(id) ON DELETE CASCADE,
	FOREIGN KEY(thread_id) REFERENCES Base(id) ON DELETE CASCADE,
	FOREIGN KEY(parent_id) REFERENCES Base(id) ON DELETE CASCADE
) ENGINE = InnoDB;